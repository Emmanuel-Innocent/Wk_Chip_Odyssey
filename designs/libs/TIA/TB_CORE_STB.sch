v {xschem version=3.4.7 file_version=1.2}
G {}
K {}
V {}
S {}
E {}
N 0 680 0 720 {lab=GND}
N 0 580 0 620 {lab=A_VSS}
N -140 340 -140 380 {lab=A_VSS}
N 120 390 120 430 {lab=A_VSS}
N 340 170 340 210 {lab=A_VDD}
N 340 270 340 300 {lab=#net1}
N -140 70 -140 110 {lab=#net2}
N -140 250 -140 280 {lab=#net3}
N 120 230 120 290 {lab=#net4}
N 190 350 190 400 {lab=A_VSS}
N 190 250 190 290 {lab=#net4}
N 120 250 190 250 {lab=#net4}
N 120 400 190 400 {lab=A_VSS}
N -140 380 -140 400 {lab=A_VSS}
N -140 400 -140 410 {lab=A_VSS}
N 340 360 340 430 {lab=A_VSS}
N -140 40 -140 70 {lab=#net2}
N 340 160 340 170 {lab=A_VDD}
N 340 150 340 160 {lab=A_VDD}
N 340 430 340 440 {lab=A_VSS}
N 120 -320 120 -280 {lab=A_VDD}
N -150 -260 -150 -40 {lab=IN_N}
N 320 -260 320 -210 {lab=OUT}
N 320 -210 320 0 {lab=OUT}
N 240 0 320 0 {lab=OUT}
N -140 40 0 40 {lab=#net2}
N 120 60 120 150 {lab=#net4}
N 120 350 120 380 {lab=A_VSS}
N 120 380 120 390 {lab=A_VSS}
N 70 -150 70 -80 {lab=A_VDD}
N 70 80 70 330 {lab=A_VSS}
N 70 330 70 410 {lab=A_VSS}
N 120 150 120 230 {lab=#net4}
N -140 110 -140 190 {lab=#net2}
N -140 410 -140 470 {lab=A_VSS}
N -140 470 -130 470 {lab=A_VSS}
N -130 470 340 470 {lab=A_VSS}
N 340 440 340 470 {lab=A_VSS}
N 120 430 120 470 {lab=A_VSS}
N 0 470 0 580 {lab=A_VSS}
N 70 410 70 470 {lab=A_VSS}
N 1020 330 1020 370 {lab=A_VSS}
N 1280 380 1280 420 {lab=A_VSS}
N 1500 160 1500 200 {lab=A_VDD}
N 1500 260 1500 290 {lab=#net5}
N 1020 60 1020 100 {lab=#net6}
N 1020 240 1020 270 {lab=#net7}
N 1280 220 1280 280 {lab=#net8}
N 1350 340 1350 390 {lab=A_VSS}
N 1350 240 1350 280 {lab=#net8}
N 1280 240 1350 240 {lab=#net8}
N 1280 390 1350 390 {lab=A_VSS}
N 1020 370 1020 390 {lab=A_VSS}
N 1020 390 1020 400 {lab=A_VSS}
N 1500 350 1500 420 {lab=A_VSS}
N 1020 30 1020 60 {lab=#net6}
N 1500 150 1500 160 {lab=A_VDD}
N 1500 140 1500 150 {lab=A_VDD}
N 1500 420 1500 430 {lab=A_VSS}
N 1420 -330 1420 -290 {lab=A_VDD}
N 1020 -270 1020 -50 {lab=#net9}
N 1480 -270 1480 -220 {lab=OUT_STB}
N 1480 -220 1480 -10 {lab=OUT_STB}
N 1400 -10 1480 -10 {lab=OUT_STB}
N 1020 30 1160 30 {lab=#net6}
N 1280 50 1280 140 {lab=#net8}
N 1280 340 1280 370 {lab=A_VSS}
N 1280 370 1280 380 {lab=A_VSS}
N 1230 -160 1230 -90 {lab=A_VDD}
N 1230 70 1230 320 {lab=A_VSS}
N 1230 320 1230 400 {lab=A_VSS}
N 1280 140 1280 220 {lab=#net8}
N 1020 100 1020 180 {lab=#net6}
N 1020 400 1020 460 {lab=A_VSS}
N 1020 460 1030 460 {lab=A_VSS}
N 1030 460 1500 460 {lab=A_VSS}
N 1500 430 1500 460 {lab=A_VSS}
N 1280 420 1280 460 {lab=A_VSS}
N 1230 400 1230 460 {lab=A_VSS}
N 1260 -270 1280 -270 {
lab=#net10}
N 1260 -350 1260 -270 {
lab=#net10}
N 1240 -270 1260 -270 {
lab=#net10}
N 1130 -270 1180 -270 {lab=#net9}
N 1340 -270 1360 -270 {lab=#net11}
N 1260 -470 1260 -410 {lab=A_VSS}
N -70 -260 -10 -260 {lab=IN_N}
N 50 -260 90 -260 {lab=#net12}
N 150 -260 320 -260 {lab=OUT}
N 1450 -270 1480 -270 {lab=OUT_STB}
N 1360 -270 1390 -270 {lab=#net11}
N 1090 -270 1130 -270 {lab=#net9}
N 1090 -50 1160 -50 {lab=#net9}
N -70 -40 -0 -40 {lab=IN_N}
N -150 -40 -70 -40 {lab=IN_N}
N -150 -260 -70 -260 {lab=IN_N}
N 1020 -50 1090 -50 {lab=#net9}
N 1020 -270 1090 -270 {lab=#net9}
C {git/Wk_Chip_Odyssey/designs/TIA/CORE_TIA.sym} 60 0 0 0 {name=x1}
C {vsource.sym} 340 330 0 0 {name=V3 value=3.3 savecurrent=false}
C {vsource.sym} 0 650 0 0 {name=V4 value=0 savecurrent=false}
C {gnd.sym} 0 720 0 0 {name=l4 lab=GND}
C {lab_pin.sym} 340 150 3 1 {name=p12 sig_type=std_logic lab=A_VDD}
C {vsource.sym} -140 310 0 0 {name=V6 value="1.2" savecurrent=false}
C {isource.sym} 120 320 0 0 {name=I3 value=20u}
C {res.sym} 340 240 0 0 {name=R4
value=10
footprint=1206
device=resistor
m=1}
C {res.sym} -140 220 0 0 {name=R5
value=10
footprint=1206
device=resistor
m=1}
C {res.sym} 190 320 0 0 {name=R6
value=1G
footprint=1206
device=resistor
m=1}
C {lab_pin.sym} 120 -320 3 1 {name=p5 sig_type=std_logic lab=A_VDD}
C {symbols/ppolyf_u_1k.sym} 120 -260 1 0 {name=R1
W=10e-6
L=10e-6
model=ppolyf_u_1k
spiceprefix=X
m=1}
C {lab_pin.sym} 320 0 2 0 {name=p1 sig_type=std_logic lab=OUT
}
C {lab_pin.sym} 70 -150 1 0 {name=p2 sig_type=std_logic lab=A_VDD
}
C {lab_pin.sym} -150 -40 0 0 {name=p4 sig_type=std_logic lab=IN_N
}
C {lab_pin.sym} -60 470 3 1 {name=p3 sig_type=std_logic lab=A_VSS}
C {devices/code_shown.sym} -1120 190 0 0 {name=MODELS1 only_toplevel=true
format="tcleval( @value )"
value="
.include $::180MCU_MODELS/design.ngspice
.lib $::180MCU_MODELS/sm141064.ngspice typical
.lib $::180MCU_MODELS/sm141064.ngspice res_typical
.lib $::180MCU_MODELS/sm141064.ngspice mimcap_typical
.lib $::180MCU_MODELS/sm141064.ngspice cap_mim
"}
C {devices/vsource.sym} 20 -260 3 0 {name=Vtest1 value="dc 0 ac 1"}
C {git/Wk_Chip_Odyssey/designs/TIA/CORE_TIA.sym} 1220 -10 0 0 {name=x2}
C {vsource.sym} 1500 320 0 0 {name=V1 value=3.3 savecurrent=false}
C {lab_pin.sym} 1500 140 3 1 {name=p6 sig_type=std_logic lab=A_VDD}
C {vsource.sym} 1020 300 0 0 {name=V5 value="1.2" savecurrent=false}
C {isource.sym} 1280 310 0 0 {name=I1 value=20u}
C {res.sym} 1500 230 0 0 {name=R7
value=10
footprint=1206
device=resistor
m=1}
C {res.sym} 1020 210 0 0 {name=R8
value=10
footprint=1206
device=resistor
m=1}
C {res.sym} 1350 310 0 0 {name=R9
value=1G
footprint=1206
device=resistor
m=1}
C {lab_pin.sym} 1420 -330 3 1 {name=p7 sig_type=std_logic lab=A_VDD}
C {symbols/ppolyf_u_1k.sym} 1420 -270 1 0 {name=R10
W=10e-6
L=10e-6
model=ppolyf_u_1k
spiceprefix=X
m=1}
C {lab_pin.sym} 1480 -10 2 0 {name=p8 sig_type=std_logic lab=OUT_STB}
C {lab_pin.sym} 1230 -160 1 0 {name=p9 sig_type=std_logic lab=A_VDD
}
C {lab_pin.sym} 1100 460 3 1 {name=p11 sig_type=std_logic lab=A_VSS}
C {devices/ammeter.sym} 1310 -270 1 1 {name=Vir1 savecurrent=true spice_ignore=0}
C {devices/ammeter.sym} 1210 -270 1 1 {name=Vif1 savecurrent=true spice_ignore=0}
C {devices/isource.sym} 1260 -380 0 1 {name=Itest1 value="dc 0 ac 1"}
C {lab_pin.sym} 1260 -470 1 0 {name=p13 sig_type=std_logic lab=A_VSS}
C {devices/code_shown.sym} -1140 -750 0 0 {name=NGSPICE only_toplevel=true
value="

.control
save all


** Simulation
op
ac dec 1001 1 1G
**remzerovec

**set appendwrite

* Middlebrook's Method
let tv=-v(OUT)/v(IN_N)
let ti=-i(vir1)/i(vif1)
let tmb=(tv*ti - 1)/(tv + ti + 2)


let mag = db(tmb)

let phase = 180/pi*cphase(tmb)




** Plots

plot mag ylabel 'Magnitude - Middlebrook'
plot phase ylabel 'Phase - Middlebrook'


setplot ac1

write TB_CORE_STB.raw
.endc
"}
